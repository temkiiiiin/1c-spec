# Тезисы

* Взаиморасчеты с контргентами ведутся в разрезе договоров
* С контрагентом можно заключить неограниченное количество договоров
* Долг контрагента возникает при проведении расходной накладной. Контрагент и его договор указываются в шапке расходной накладной. Запрещено указывать не соответствующий контрагенту договор
* Проводки расходной накладной:

    ```Text
    Дт "Покупатели" - Кт "Прибыли и убытки" на сумму продажи
    ```

* Погашение задолженности контрагента осуществляется документом "Приход денег", в табличной части которого указываются `Контрагент`, `Договор контрагента` и `Сумма`
* Задолженность может гаситься частями
* Документ прихода денег не должен проводиться, если сумма оплаты больше суммы задолженности по договору
* Проводки прихода денег:

    ```Text
    Дт "Касса" - Кт "Покупатели" на указанную сумму
    ```

* Структуры требуемых отчетов
  * Задолженность покупателей

        |   Контрагент    |   Договор         |   Сумма   |
        ---------------------------------------------------
        |   Тортоед       |                   |   3       |
        |   Тортоед       |   Основной        |   1       |
        |   Тортоед       |   Дополнительный  |   2       |

## Решение

### Исследование тезисов

* ***"Взаиморасчеты с контргентами ведутся в разрезе договоров. С контрагентом можно заключить неограниченное количество договоров. Запрещено указывать не соответствующий контрагенту договор".*** Потребуются справочники Контрагенты и ДоговорыКонтрагентов. Справочник ДоговорыКонтрагентов подчинен справочнику Контрагенты.
* ***"Долг контрагента возникает при проведении расходной накладной. Контрагент и его договор указываются в шапке расходной накладной".*** В шапке расходной накладной необходимо заполнять контрагента и его договор.
* ***"Погашение задолженности контрагента осуществляется документом "Приход денег", в табличной части которого указываются `Контрагент`, `Договор контрагента` и `Сумма`".*** Нужен документ `ПриходДенег` с табличной частью с требуемыми реквизитами.
* ***"Задолженность может гаситься частями. Документ прихода денег не должен проводиться, если сумма оплаты больше суммы задолженности по договору".*** При проведении документа прихода денег необходимо контролировать остаток задолженности контрагента по договору.

### Разработка

#### Начнем разработку с изменения структуры данных

Решать задачу будем на базе решения задачи 001 оперативного учета.

Структура измененных объектов:

* Справочники
  * ДоговорыКонтрагентов
    * Владельцы
      * Справочник.Контрагенты
* Документы
  * РасходнаяНакладная
    * Реквизиты
      * Контрагент (СправочникСсылка.Контрагенты)
      * ДоговорКонтрагента (СправочникСсылка.ДоговорыКонтрагентов). Для свойства на форме элемента необходимо установить связи параметров выбора по контрагенту владельцу
  * ПриходДенег
    * ТабличныеЧасти
      * Состав
        * Контрагент (СправочникСсылка.Контрагенты)
        * ДоговорКонтрагента (СправочникСсылка.ДоговорыКонтрагентов). Для свойства на форме элемента необходимо установить связи параметров выбора по контрагенту владельцу
        * Сумма (Число)
* Планы счетов
  * Управленческий
    * Максимальное количество субконто - 2
    * Виды субконто - (ПланыВидовХарактеристик.ВидыСубконто)
    * Предопределенные
      * Активы
        * Покупатели
          * Виды субконто
            * Контрагент
            * ДоговорКонтрагента
* Планы видов характеристик
  * ВидыСубконто
    * Тип значения характеристик
      * (СправочникСсылка.Субконто)
      * (СправочникСсылка.Контрагенты)
      * (СправочникСсылка.ДоговорыКонтрагентов)
    * Дополнительные значения характеристик - (СправочникСсылка.Субконто)
    * Предопределенные
      * Контрагент (СправочникСсылка.Контрагенты)
      * ДоговорКонтрагента (СправочникСсылка.ДоговорыКонтрагентов)
* Регистры бухгалтерии
  * Управленческий
    * ПланСчетов - Управленческий. Уже есть в каркасной конфигурации
    * Корреспонденция - Истина
    * Ресурсы
      * Сумма (Число)

Так как отчет должен строиться по задолженности контрагентов в разрезе договоров, то для плана счетов устанавливается максимальное количество субконто равным 2 и к счету `Покупатели` добавляем 2 вида субконто: Контрагент и ДоговорКонтрагента

### Проведение документа Расходная накладная